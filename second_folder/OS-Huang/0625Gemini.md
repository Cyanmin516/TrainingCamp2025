# Windows Server 帳戶與 NTFS 權限設定筆記

**講者**: pro.Huang
**日期**: 2025-06-25
**主題**: 使用者 NTFS 權限管理

---

## 帳戶與資料夾權限配置概述

本文件旨在提供使用者帳戶設定及共用資料夾權限配置的詳細指引。

### 範例 1：基本使用者與資料夾權限設定

此範例說明了三個使用者帳戶的創建，以及 `D:\public` 資料夾及其子資料夾的權限配置。

1.  **使用者帳戶建立**:
    * 建立三個本機使用者帳戶：`User1`、`User2`、`User3`。

2.  **基本共用資料夾設定**:
    * 在 `D:\` 磁碟下建立一個名為 `public` 的資料夾。
    * `public` 資料夾應對所有使用者設定為**唯讀 (Read-only)** 權限。

3.  **`public` 子資料夾建立**:
    * 在 `D:\public` 內部建立以下三個子資料夾：
        * `D:\public\user1`
        * `D:\public\user2`
        * `D:\public\pub`

4.  **`user1` 資料夾權限**:
    * `User1` 對 `D:\public\user1` 資料夾擁有**完全控制 (Full Control)** 權限。
    * `User2` 對 `D:\public\user1` 資料夾擁有**讀取 (Read)** 權限。

5.  **`user2` 資料夾權限**:
    * `User2` 對 `D:\public\user2` 資料夾擁有**完全控制 (Full Control)** 權限。
    * `User1` 對 `D:\public\user2` 資料夾擁有**讀取 (Read)** 權限。

6.  **`pub` 資料夾權限**:
    * `User1` 和 `User2` 對 `D:\public\pub` 資料夾均擁有**完全控制 (Full Control)** 權限。
    * 系統上所有**其他使用者** (包括 `User3`) 對 `D:\public\pub` 資料夾擁有**唯讀 (Read)** 權限。

#### 權限衝突情境與解答:

1.  **問題**: `User2` 在其他使用者的資料夾下創建了一個資料夾 (`D:\public\user1\u2`)。
    * **解答**: `User1` **可以**刪除該資料夾，因為 `User1` 從其資料夾的**建立者/擁有者 (create owner)** 繼承了權限。

2.  **問題**: `User2` 建立新規則。
    * **解答**: `User2` 可以在其自己的資料夾下建立資料夾並設定存取控制權限。

### 範例 2：設計與行政部門的權限配置

此範例詳細說明了如何建立結構化的檔案系統，並為特定使用者群組配置適當的權限。

1.  **使用者與群組配置**:
    * 建立兩個使用者帳戶 `designer1` 和 `designer2`，並將其指派到 `design_class` 群組。
    * 建立兩個使用者帳戶 `clerk1` 和 `clerk2`，並將其指派到 `clerk_class` 群組。

2.  **目錄結構**:
    * 在 `E:\public` 目錄下建立以下子資料夾，用於檔案組織：
        * `E:\public\share`
        * `E:\public\Designers`
        * `E:\public\Clerks`

3.  **存取控制與權限**:
    * **`E:\public\Designers` 資料夾**:
        * 僅授予 `design_class` 群組成員**完全控制 (Full Control)** 權限。
        * 其他所有使用者不應擁有存取權限。
    * **`E:\public\Clerks` 資料夾**:
        * 僅授予 `clerk_class` 群組成員**完全控制 (Full Control)** 權限。
        * 其他所有使用者不應擁有存取權限。
    * **`E:\public\share` 資料夾**:
        * 授予 `design_class` 和 `clerk_class` 兩個群組的所有成員**完全控制 (Full Control)** 權限。
        * 此資料夾不應供其他所有使用者存取。

---

## 設定流程指引

1.  **停用繼承與清除特殊權限**:
    * 右鍵點擊資料夾 > 選擇「安全性」> 選擇群組「Users」> 點擊「進階」。
    * **取消繼承**（選擇保留現有權限或全部清空）。
    * 刪除所有特殊權限。這樣使用者只會剩下讀取功能。

2.  **設定特定使用者權限**:
    * 右鍵點擊資料夾 > 選擇「安全性」> 選擇群組「Users」> 點擊「編輯」（進行使用者設定）。

3.  **重要提示**:
    * 使用者帳戶無法關閉伺服器。
    * **在移除群組權限之前，務必先移除繼承。**

### 使用者帳戶管理

* **路徑**: 伺服器管理員 > 工具 > 電腦管理 > 本機使用者和群組。

* **管理員帳戶 (Administrator)**:
    * 預設帳戶名稱，建議首次使用時更改名稱。
    * 為安全起見，可以建立一個權限較低的帳戶作為日常管理員使用。

* **使用者帳戶 (Users)**:
    * 使用者名稱建議使用英文。
    * 全名和描述為可選欄位。

### 為虛擬機 (VM) 新增磁碟

* **VMware 設定**: 虛擬機設定 > 新增... > 硬碟 > NVMe (僅限關機狀態) > 建立新的虛擬磁碟 > 20 GB，單一檔案 > 檔名 (無需更改) > 完成。
* **重新啟動 VM**:
* **伺服器管理員操作**: 伺服器管理員 > 檔案和存放服務 > 磁碟區 > 磁碟 > 右鍵點擊磁碟 > 選擇「上線/連線」。

* **VMware 熱插拔支援**: SATA 和 SCSI 磁碟支援熱插拔（無需關機），而 IDE 和 NVMe 磁碟則需要關機才能新增。

---

## 密碼原則設定

**路徑**: 伺服器管理員 > 工具 > 本機安全性原則 > 帳戶原則 > 密碼原則。

1.  **密碼必須符合複雜性需求**:
    * **啟用此原則後，密碼必須滿足以下最低要求**:
        * 不得包含使用者帳戶全名中連續超過兩個字元。
        * 長度至少為 6 個字元。
        * 包含以下四種字元中的至少三種：
            * 英文大寫字元 (A 到 Z)
            * 英文小寫字元 (a 到 z)
            * 10 進位數字 (0 到 9)
            * 非英文字母字元 (例如: !、$、#、%)
    * **強制執行**: 密碼建立或變更時強制執行。

2.  **密碼最長使用期限**:
    * **定義**: 密碼在系統要求使用者變更前可使用的最長天數。
    * **範圍**: 1 至 999 天；設為 0 表示永不過期。
    * **關聯**: 若此值介於 1-999，則「密碼最短使用期限」不得超過此值。若設為 0，則「密碼最短使用期限」可為 0-998 天。

3.  **密碼最短使用期限**:
    * **定義**: 密碼在使用者變更前必須使用的最短天數。
    * **範圍**: 1 至 998 天；設為 0 表示允許立即變更。
    * **關聯**: 不得超過「密碼最長使用期限」，除非「密碼最長使用期限」為 0。
    * **注意**: 若要啟用「強制執行密碼歷程記錄」，此值應設為 0 以上。預設值為 1，以確保使用者選擇新密碼。

4.  **強制執行密碼歷程記錄**:
    * **定義**: 在重複使用舊密碼之前，必須使用的唯一新密碼數量。
    * **範圍**: 0 至 24 個密碼。
    * **目的**: 增加安全性，防止使用者重複使用舊密碼。

5.  **最小密碼長度**:
    * **定義**: 使用者帳戶密碼所需的最少字元數。
    * **範圍**:
        * 若「放寬最小密碼長度限制」未定義或已停用：0 到 14。
        * 若「放寬最小密碼長度限制」已定義並啟用：0 到 128。
    * **注意**: 設為 0 表示不需要密碼。

6.  **使用可還原的加密來存放密碼**:
    * **定義**: 作業系統是否使用可還原的加密來存放密碼。
    * **安全性考量**: 這等同於存放純文字密碼。**除非應用程式需求高於密碼保護，否則不應啟用此原則。**
    * **應用場景**: 某些驗證協定 (如 Challenge-Handshake 驗證協定用於遠端存取或 IAS) 和 IIS 中的摘要式驗證可能需要此原則。

---

## NTFS 權限核心原則

理解以下三個核心原則對於管理 NTFS 權限至關重要：

1.  **累加性 (Additive)**:
    * 當使用者是多個群組的成員，且這些群組對同一檔案或資料夾擁有不同的「允許」權限時，所有「允許」權限會疊加起來。使用者最終將擁有這些權限的總和。

2.  **繼承 (Inheritance)**:
    * 在父資料夾上設定的權限會自動應用（繼承）到其所有新的子資料夾和檔案。這大大簡化了權限管理。

3.  **拒絕大於允許 (Deny Overrides Allow)**:
    * 這是最重要的原則。任何明確設定的「拒絕」權限，將會覆蓋所有「允許」權限（無論是繼承還是明確設定的）。只要使用者或其所屬的任何群組被明確「拒絕」某項操作，該使用者就無法執行該操作。

---

## 共用權限與 NTFS 權限的協同作用

在 Windows Server 中，共用資料夾的權限設定需要同時考慮**共用權限**和 **NTFS 權限**。

* **共用權限**:
    * **設定位置**: 資料夾的「內容」>「共用」索引標籤 >「進階共用」。
    * **權限類型**: 讀取、變更、完全控制。
    * **影響範圍**: 僅影響透過**網路存取**資料夾的使用者。

* **NTFS 權限**:
    * **設定位置**: 資料夾的「內容」>「安全性」索引標籤。
    * **權限類型**: 更細緻，包括讀取、讀取和執行、寫入、修改、刪除、完全控制等。
    * **影響範圍**: 適用於所有存取資料夾的使用者，無論是透過網路還是直接在伺服器上。

**兩者共同作用，決定了最終的存取控制。最嚴格的權限將被應用。**

### 設定原則

1.  **最小權限原則**:
    * 授予使用者或群組執行其任務所需的最低權限，以最小化安全風險。

2.  **先共用權限，再 NTFS 權限**:
    * 首先確保透過網路存取的使用者擁有合適的共用權限，然後再透過 NTFS 權限進一步限制其在伺服器上的存取。

3.  **使用者和群組權限**:
    * 應明確地為使用者帳戶和群組帳戶設定權限，避免不必要地使用「所有人」群組。

4.  **審核**:
    * 建議啟用審核功能，記錄使用者對資料夾的存取行為，以便追蹤和分析。

### 建議設定步驟

1.  **設定共用權限**:
    * 右鍵點擊資料夾 >「內容」>「共用」>「進階共用」。
    * 勾選「共用此資料夾」，設定共用名稱，並點擊「許可權」。
    * 移除「所有人」群組，並新增需要共用存取權限的使用者或群組，設定適當的權限（讀取、變更等）。

2.  **設定 NTFS 權限**:
    * 右鍵點擊資料夾 >「內容」>「安全性」>「編輯」。
    * 移除「所有人」群組，並新增需要存取權限的使用者或群組，設定適當的權限（讀取、寫入、修改等）。

3.  **測試權限**:
    * 從不同的客戶端電腦，使用不同的使用者帳戶進行測試，以確認權限設定符合預期。
    * 使用審核功能記錄存取行為以供檢查。

---

## 新增硬碟的流程概覽

無論是實體磁碟還是虛擬磁碟，新增到 Windows Server 後，通常遵循以下幾個主要步驟：

1.  **安裝或掛載磁碟**:
    * 物理連接新硬碟，或在虛擬化環境中添加虛擬磁碟。

2.  **初始化磁碟 (Initialize Disk)**:
    * 這是磁碟初次使用的必經之路，決定了磁碟的分區方式 (MBR 或 GPT)。

3.  **建立磁碟區/分區 (Create Volume/Partition)**:
    * 將初始化後的磁碟劃分為一個或多個邏輯區域。

4.  **格式化磁碟區 (Format Volume)**:
    * 設定檔案系統（如 NTFS）並準備儲存資料。

5.  **指派磁碟機代號或掛接點 (Assign Drive Letter or Mount Point)**:
    * 讓系統和使用者能夠存取該磁碟區。