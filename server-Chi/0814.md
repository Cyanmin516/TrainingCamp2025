# Linux Network Setting
- speacher: pro.Chi
- date: 2025-8-14
- class 6
- vbird Chapter 5
- vbird Chapter 12
- vbird Linux server 1

#ifconfig #NetworkManager #nmtui #nmcli #rpm #DNS #除錯

## 實務
- 檢查執行中的程序與設定檔是否一致
- 網路設定從設定檔改寫 
- 


## 修改設定
1. 目錄 
    - 主目錄 : `/etc/NetworkManager`
    - 網卡 : system-connections
    - 網卡編號 : nmconnection
    - **重啟網路服務後啟用**
    - 舊目錄
        - /etc/sysconfig/network-scripts/
        - ifconfig 
        - network        
2. root# 
    - #nmgui, 圖形化網路介面
    - #nmtui, 文字圖片網路介面
    - #nmcli, 純文字
    - **以上更改立即生效**
3. 暫時更改
    - ip link
    - ip address
    - ip route


## VMware
1. 關機改網卡
改網卡 NAT => bridge
新增網卡 => 客製化VMware VM3
查看網卡=> 實體網卡
**vm0對外bridge綁定實體網卡** VMware => edit => Virtual Network Editor =>  change setting(admin) => bridge to: `實體網卡` => apply, OK
實體網卡怎麼看: win11桌面右鍵網路 => 網路共和中心 => 內容 => 網路,製造商,描述 `Realtek PCIe GbE Family Controller`
2. 查看
- ip addr show
- nmtui
- ip lnk show
- nmcli connect show 

## 12 軟體管理rpm
1. 設定檔, 設定倉儲
/etc/yum.repos.d/*.repo
2. 指令 
dnf {insall | delete | update | upgrade}
3. 軟體名稱.rpm
cat /etc/yum/repos/d/centos.repo

### 未認證的
dnf  install epel-release
dnf update

## DNS in linux
1. dns name
- dns.studentX.example.com
    - x is your seat number
    - ip
- BIND
- 啟動
- 防火牆
- 測試

###
1. dnf install bind-*
- bind-9.16
- bind-9.18 有衝突
- dnf install bind bind-chroot bind-utils
2. systemctl hostname `dns.studentX.example.com`
-  nmcli connection modify ens160 ipv4.method manual ipv4.addresses IP/24 
- nmcli connection up ens160
    - dnf clean all
3. #vim /etc/named.conf
- inster `i`
- listen-on port 53 {`ip;` 127.0.0.1;};
- 註解IPv6, `//listen-on-v6`
- allow-query {`IP.0/24;` localhost;}; //一個網段
- write and quit `:wq`
4. systemctl enable --now named
- systemctl status named -l
- firewall-cmd --add-service=dns --permanent
- firewall-cmd --add-service=dns
- dig localhost @IP
5. #vim /etc/named.conf
```sh
//add last lin
incldue "/etc/named/student.conf";
```
- #vim /etc/named/student.conf
```sh
zone "studentX.example.com" IN{
    type master;
    file "/var/named/student.zone";
};
```
- #vim /var/named/student.zone
```sh
$TTL 10
@   IN SOA dns.studentX.example.com. root ( ;註解用分號 @為本地 dns最後要加.
    2025001 ;serial number
    1H 
    2D ;try again backoff
    3W ;try until
    10 ;life time
)

@   IN NS dns.studentX.com.

```
### 除錯
1. 確保路徑名稱一致 named.conf; student 拼錯, 檔案名稱不是網域名稱
include "/etc/named/student.conf"
2. $TTL 不要插入空格, root 位置前後空格 
```sh /var/named/student.zone
$TTL 10
@       IN SOA dns.student103.example.com. root ( ;@localhost
        20250814 ;serial number
        1H
        2D ;try next time
        3w ;try until
        10 ;life time
        )
@       IN NS dns.student103.example.com.

dns IN A 10.10.53.103
www IN A 10.10.53.103
```

3. See "systemctl status named.service"
>9月 12 11:32:34 dns.student3.example.com bash[8037]: dns_rdata_fromtext: /var/named/student.zone:2: near '.root': empty label

會明確告訴檔案錯誤資訊

## Gemini

在 Linux 中，基礎網路設定主要涉及 IP 位址、子網路遮罩、預設閘道器和 DNS 伺服器的配置。這些設定可以用多種方式完成，最常見的方法有以下幾種：

-----

### **1. 暫時性設定：使用 `ip` 或 `ifconfig` 指令**

這些指令的設定只在系統重開機前有效，適合於臨時測試或除錯。

  * **配置 IP 位址和子網路遮罩：**
      * 使用 `ip` 指令：`sudo ip addr add 192.168.1.100/24 dev eth0`
          * `192.168.1.100/24` 是您想設定的 IP 和 CIDR 格式的子網路遮罩。
          * `eth0` 是您要設定的網路介面名稱。
      * 使用 `ifconfig` 指令 (較舊)：`sudo ifconfig eth0 192.168.1.100 netmask 255.255.255.0`
  * **配置預設閘道器：**
      * `sudo ip route add default via 192.168.1.1`
          * `192.168.1.1` 是您路由器的 IP 位址。
  * **查看網路設定：**
      * `ip addr show` 或 `ifconfig`
      * `ip route show`

-----

### **2. 永久性設定：編輯設定檔**

這種方式的設定會在系統重開機後仍然生效，是生產環境中最常用的方法。設定檔的位置和格式會因 Linux 發行版而異。

#### **對於基於 Debian (如 Ubuntu) 的系統：**

  * **網路設定檔：** `/etc/network/interfaces`
  * **範例設定：**
    ```
    # 設定靜態 IP
    auto eth0
    iface eth0 inet static
        address 192.168.1.100
        netmask 255.255.255.0
        gateway 192.168.1.1
    ```
  * **套用設定：**
      * `sudo systemctl restart networking` 或 `sudo service networking restart`

#### **對於基於 RHEL/CentOS/Fedora 的系統：**

  * **網路設定檔：** `/etc/sysconfig/network-scripts/ifcfg-eth0` (檔名中的 `eth0` 依介面名稱而定)
  * **範例設定：**
    ```
    DEVICE=eth0
    BOOTPROTO=static
    ONBOOT=yes
    IPADDR=192.168.1.100
    NETMASK=255.255.255.0
    GATEWAY=192.168.1.1
    ```
  * **套用設定：**
      * `sudo systemctl restart network` 或 `sudo service network restart`

-----

### **3. DNS 伺服器設定**

DNS 伺服器設定通常是獨立於 IP 位址的。

  * **設定檔：** `/etc/resolv.conf`
  * **範例設定：**
    ```
    nameserver 8.8.8.8
    nameserver 8.8.4.4
    ```
      * `8.8.8.8` 和 `8.8.4.4` 是 Google 的公共 DNS 伺服器。
  * **注意事項：** 在某些系統中，此檔案可能會被網路管理工具自動覆蓋。若要永久設定，您可能需要修改網路管理工具的相關設定檔，例如在 Ubuntu 中修改 `/etc/netplan` 設定檔。

### **4. 使用 `nmtui` 工具**

許多發行版都內建了 `NetworkManager`，您可以使用文字介面的 `nmtui` 工具來輕鬆設定網路。

  * **啟動工具：** `sudo nmtui`
  * **操作：** 您可以透過方向鍵和 Enter 鍵來選擇「Edit a connection」，然後修改 IP、閘道器和 DNS 等設定。

-----

**總結：**

  * **臨時設定** 使用 `ip` 或 `ifconfig` 指令，快速方便但重開機後會失效。
  * **永久設定** 編輯對應的設定檔，確保網路設定在重開機後依然有效。
  * **圖形化工具** `nmtui` 則提供了一個簡單易用的介面來管理網路設定。

您可以根據自己的需求和系統發行版選擇最適合的方法。如果您不確定您的系統是哪個發行版，可以執行 `cat /etc/os-release` 來查看。
 
