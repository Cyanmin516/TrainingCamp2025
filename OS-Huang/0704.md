# Windows Server 2022 DC服務

**講者**: pro.Huang
**日期**: 2025-7-4
**主題**: Domain Controller管理

## 前情提要
1. 虛擬機有 fileserver、pc1、DS
2. 課程完成: 網路設定、NTFS權限、共享網路磁碟機


## 網域密碼原則
工具 > 群組原則管理 > 
1. 樹系
2. `網域`
3. Default Domain Policy
4. 右鍵 編輯

在Default Domain Policy
1. 電腦設定 
2. 原則 
3. Windows設定 
4. 安全性原則
5. 帳戶原則
6. 密碼原則

### 網域更新請用指令
強制網域內立即更新
>gpupdate /force

## 使用者

### AD DC
1. Active Directory 使用者和電腦
2. lab03.com.tw
3. Computers 
    * 網域內電腦

### DNS
1. DNS管理員
2. DC
3. 正向對應區域
4. (網域)lab03.com.tw
5. 

 **DNS (Domain Name System) 和 DHCP (Dynamic Host Configuration Protocol) 都是網路服務，但它們的功能和管理範圍不同。**

---

#### 加入網域
**FileServer**
1. 在你的虛擬機(FileServer)修改DNS
2. 工作群組 變更，改成 `網域`
3. 登入 administrator/`password` 這是DC使用者
4. 歡迎加入後重新啟動
5. 類型為`主機(A)` 其中的A是指IPv4

**一般電腦**
1. win右鍵
2. 系統
3. 重新命名此電腦(進階)
4. 網域 變更 ，完成後跳去步驟 6.
    * `網域` > 登入 > 重啟
5. 網路識別
    1. 選商業網路
    2. 選有網域的網路
    3. 登入(可能失敗)
    4. 重新登入?
    5. 選新增下列網域使用者
    6. 選標準帳戶
6. 重啟
7. 登入 `網域名稱\網域使用者`、`password`


#### 新增使用者
虛擬機(FileServer)密碼原則被DC原則覆蓋並且鎖定
仍可以新增使用者但只能使用本機(FileServer)

#### 使用登入
加入網域的其他設備。`administrator`預設管理員帳號是`本機`，使用網域管理員`lab30.com.tw\administrator` 或是`administrator@Lab03`
每次登入都會建立使用者目錄


檔案伺服器通常不會新增使用者，由AD來管理使用者

## filerserver 共用
* 新增`Domain Users`到NTFS群組權限，使其他`labmen`可以共享資料夾
* 共用權限全部打勾
* 停用`users`避免本機使用者繞過DS控制權限。預設NTFS允許全部使用者讀取

### 複習共用
1. 進入FileServer上D曹
2. 新增資料夾 滑鼠右鍵
    * NTFS
        * 授予存取全給 > 特定人員
        * 內容 > 安全性 > 進階
    * 共用
        * 共用 > [不用輸入] > 共用 > 完成 ; 共用設定`完全修改`
        * 進階共用 > 權限 > 新增 > 進階 > 找到目前存在的使用者或群組
    * 共用僅在最上層設定，自動繼承。`Domain Users`僅供認證過帳戶存取
3. 開啟網路探索
4. 開啟 PC1 > 開啟 資料夾
5. 右鍵 我的電腦 > 新增網路磁碟機 
    * 選擇磁碟編號
    * `\\fileserver\share` or `\\ip\target`

### 使用者重建
錯誤刪除使用者後
* 會移除成員資料與權限
* 帳號名稱與密碼重複也無法直接復原
* 需重新加入群組與設定規則

### 使用者可視範圍
在`fileserver`設定使用者沒有`讀取`權限就`隱藏資料夾`
1. 伺服器管理員
2. 檔案和存放服務
3. 共用
4. 設定
5. 啟用存取型列舉














by Gemini
---

### DNS (Domain Name System) 是什麼？
**DNS 主要負責「網域名稱」的管理。** 它的核心功能是將人類易於記憶的**網域名稱** (例如 `www.example.com`) 翻譯成機器可以理解的**IP 位址** (例如 `192.168.1.1`)。你可以把它想像成網際網路的「電話簿」，你輸入一個名字，它會告訴你對應的電話號碼。

**DNS 的管理包括：**
* **網域名稱解析：** 將網域名稱轉換為 IP 位址，反之亦然。
* **A 記錄：** 將網域名稱指向特定的 IPv4 位址。
* **AAAA 記錄：** 將網域名稱指向特定的 IPv6 位址。
* **CNAME 記錄：** 將一個網域名稱指向另一個網域名稱（別名）。
* **MX 記錄：** 指定負責處理該網域電子郵件的郵件伺服器。
* **NS 記錄：** 指定該網域的名稱伺服器。

總之，DNS 管理的是「名稱」與「位址」之間的映射關係，以便使用者能夠透過網域名稱來存取網路資源。

---

### DHCP (Dynamic Host Configuration Protocol) 是什麼？
**DHCP 主要負責「IP 位址」的自動分配和網路配置。** 它的功能是在網路中動態地為裝置分配 IP 位址、子網路遮罩、預設閘道和 DNS 伺服器等網路設定參數。

**DHCP 的管理包括：**
* **IP 位址分配：** 自動為連接到網路的裝置分配 IP 位址，避免手動配置的錯誤和衝突。
* **IP 租約：** 為分配的 IP 位址設定一個租用期限，期限到了會自動續約或釋放。
* **網路參數配置：** 除了 IP 位址，DHCP 還能同時提供子網路遮罩、預設閘道、**DNS 伺服器位址**等資訊給客戶端。
* **IP 保留：** 可以設定特定的 MAC 位址始終獲得相同的 IP 位址（靜態 IP 分配）。

總之，DHCP 管理的是區域網路內的「IP 位址分配」和「網路配置」，確保裝置能夠正確連接到網路並進行通訊。

---

### 兩者關聯與差異
* **DNS 專注於網域名稱的解析和管理，讓使用者可以用好記的名稱來訪問服務。**
* **DHCP 專注於 IP 位址的動態分配和網路配置，讓裝置能自動取得上網所需的資訊。**

**它們是網路運作中互補的兩個重要服務。** 當你的裝置透過 DHCP 取得 IP 位址時，DHCP 伺服器通常也會一併提供 DNS 伺服器的位址給你，這樣你的裝置才能夠利用 DNS 服務來解析網域名稱，進而訪問網際網路上的網站或服務。

所以，雖然兩者都涉及「位址」和「網路管理」，但它們的角色和管理的「網域」概念是不同的。DNS 管理的是**網域名稱系統**中的網域，而 DHCP 則是在**區域網路內部**管理 IP 位址的分配。

在 Windows Server 上，**Active Directory 網域服務 (AD DS)** 是作為網域控制站 (Domain Controller, DC) 的核心服務。簡單來說，它是一個目錄服務，提供集中化的方式來管理網路中的使用者、電腦和其他資源。

以下是 AD DS 在 Windows 網域控制站上的一些主要服務和用途：

---
# AD DC
### **核心功能：身分與存取管理**

* **使用者與電腦帳戶管理：** AD DS 儲存了網域中所有使用者和電腦的帳戶資訊，包括使用者名稱、密碼、群組成員資格等。這讓管理員可以集中建立、修改和刪除這些帳戶。
* **驗證 (Authentication)：** 當使用者或電腦嘗試存取網路資源時，AD DS 會驗證其身分。它會核對提供的憑證（例如使用者名稱和密碼）與目錄中儲存的資訊，確保只有授權的使用者才能登入。
* **授權 (Authorization)：** 驗證成功後，AD DS 會決定使用者或電腦對特定資源擁有什麼權限。例如，它會判斷使用者是否可以存取某個資料夾、執行某個應用程式或使用某台印表機。
* **單一登入 (Single Sign-On, SSO)：** 透過 AD DS，使用者只需登入一次，就可以無縫存取網域中所有已授權的資源，無需重複輸入憑證。這大大提升了使用者體驗和工作效率。

---

### **資料儲存與結構**

* **目錄資料庫 (Directory Database)：** AD DS 使用一個結構化的資料庫（稱為 **Ntds.dit**）來儲存所有網路物件的資訊。這些物件包括使用者、群組、電腦、印表機、應用程式等。
* **架構 (Schema)：** 這是一組規則，定義了目錄中可以包含的物件類別和屬性，以及它們的限制和命名格式。簡單來說，它定義了 Active Directory 資料庫的結構。
* **通用類別目錄 (Global Catalog)：** 儲存了目錄中所有物件的部分屬性資訊。它允許使用者和管理員快速搜尋和找到目錄中的任何物件，無論該物件實際儲存在哪個網域中。
* **複寫服務 (Replication Service)：** AD DS 會將目錄資料在網域中的所有網域控制站之間進行複寫。這確保了網域資料的一致性，並且在某個 DC 發生故障時，其他 DC 仍然可以提供服務，提高系統的可用性。

---

### **管理與策略實施**

* **群組原則 (Group Policy)：** 這是 AD DS 最強大的功能之一，允許管理員對網域中的使用者和電腦設定和強制執行各種策略。例如，可以設定密碼複雜度要求、桌面背景、軟體安裝、安全性設定等。
* **組織單位 (Organizational Units, OUs)：** 允許管理員將網域中的物件（如使用者、電腦、群組）組織成邏輯的、階層式的結構。這有助於簡化管理，並可以將管理權限委派給特定的使用者或群組。

---

### **其他相關服務**

雖然嚴格來說不全是 AD DS 的一部分，但以下服務通常與 AD DC 緊密整合，並對其功能至關重要：

* **DNS 伺服器 (Domain Name System Server)：** DNS 是 Active Directory 的基石。DC 通常會同時作為 DNS 伺服器，負責將網域名稱解析為 IP 位址，這對於網域控制站之間的相互定位和客戶端找到 DC 都至關重要。
* **Netlogon 服務：** 負責維護網域控制站與網域成員（包括其他 DC）之間的安全通道，並註冊 DC 在 DNS 中的服務記錄。
* **Kerberos 分發中心 (Kerberos Distribution Center, KDC)：** 這是 Kerberos 驗證協定的關鍵部分，Active Directory 網域主要使用 Kerberos 進行驗證。KDC 負責發放票證，允許使用者安全地存取網路資源。
* **分散式檔案系統複寫 (DFS-R)：** 用於在多個伺服器之間同步檔案和資料夾，特別是 SYSVOL 資料夾（儲存群組原則物件和登入腳本）。它取代了舊版 Windows Server 中的檔案複寫服務 (FRS)。

---

總結來說，Windows 上的網域控制站（以及其運行的 AD DS）是企業網路的**核心大腦**，負責管理身分、存取權限、安全策略和各種網路資源。它提供了一個集中、安全且可擴展的平台，使得大型網路的管理變得高效和可行。