# AD網域架構共用權限設定 and 網頁伺服器
- speacher: pro. Huang
- date: 2025-7-25
- class 7
#管理磁碟 #密碼原則 #AD網域 #權限設定 #failed #群組原則管理 #IIS #網頁伺服器

## 更改磁碟代號與新增硬碟
- windows10 系統修改磁碟槽
1. 開資料夾，對左側本機右鍵，選`管理` 
2. 電腦管理 > 存放裝置 > 磁碟管理 >對 DVD(E:)右鍵 > 變更磁碟機代號及路徑... > 變更到未使用的代號
3. 未分配區右鍵 > 新增簡單磁碟區(可以延伸) > GPT格式 >NTFS管理>格式化>給代號>完成
4. 如果是熱插拔(虛擬機)則要讓硬體裝置`上線`

## AD 使用者
- 工具 > AD網域管理中心
- Lab03 > 新增 組織 > 新增 使用者> 新增群組
- `qpupdate /force`更新使用者與群組至網域

### 密碼原則
1. 工具 > 群組原則管理
    - 群組原則管理
    - 樹系
    - 網域
    - Lab03.com.tw
    - default Domain Policy 
    - 右鍵 編輯
2. 群組原則管理編輯器
    - 電腦設定
    - 原則
    - Windows設定
    - 安全性設定
    - 密碼原則
    - 密碼複雜度需求 > 已停用

### 資料夾權限
1. 共用 移除`everyone` > 新增 `domain users`
2. 安全性 > 進階 > **停用繼承** > 移除

## AD 使用者設定failed區
- 使用者未設置密碼

## 密碼原則 by Gemini
在 Windows Server 2022 的 AD 網域中，修改密碼安全性原則主要有兩種方式：

1.  **預設網域密碼原則 (Default Domain Policy)**：這是最常見也是最基本的設定方式，它會影響整個網域中的所有使用者。
2.  **細部密碼原則 (Fine-Grained Password Policies, FGPP)**：如果你需要為網域中特定使用者或群組（例如：特權帳戶）設定比預設網域原則更嚴格或不同的密碼要求，就可以使用 FGPP。

-----

### **1. 修改預設網域密碼原則**

預設網域密碼原則透過**群組原則管理編輯器 (Group Policy Management Editor)** 來設定。

**步驟：**

1.  **開啟群組原則管理 (Group Policy Management)**：

      * 在網域控制器上，點擊「開始」-\>「Windows 系統管理工具」-\>「**群組原則管理**」。

2.  **編輯預設網域原則：**

      * 在「群組原則管理」視窗中，展開「樹系：[你的網域名稱]」-\>「網域」-\>「[你的網域名稱]」。
      * 找到「**Default Domain Policy**」，右鍵點擊它，然後選擇「**編輯**」。

3.  **導覽至密碼原則：**

      * 在「群組原則管理編輯器」中，依序導覽到：
          * **電腦設定 (Computer Configuration)**
          * **原則 (Policies)**
          * **Windows 設定 (Windows Settings)**
          * **安全性設定 (Security Settings)**
          * **帳戶原則 (Account Policies)**
          * **密碼原則 (Password Policy)**

4.  **設定密碼原則項目：**

      * 在右側窗格中，你會看到多個密碼相關的原則項目，你可以雙擊每個項目來進行設定：
          * **強制執行密碼歷程記錄 (Enforce password history)**：使用者不能重複使用多少個舊密碼。建議設定為 10-24 個。
          * **密碼最長使用期限 (Maximum password age)**：密碼多少天後必須變更。例如：90 天。
          * **密碼最短使用期限 (Minimum password age)**：使用者在變更密碼後，至少要等多少天才能再次變更。建議設定為 1-3 天，以防止使用者立即更改回舊密碼。
          * **最小密碼長度 (Minimum password length)**：密碼最少需要的字元數。建議至少 12-15 個字元。
          * **密碼必須符合複雜性需求 (Password must meet complexity requirements)**：啟用此選項會要求密碼包含大寫字母、小寫字母、數字和特殊符號中的至少三種類型，且不能包含使用者帳戶名稱或顯示名稱的某些部分。強烈建議啟用。
          * **使用可還原的加密來儲存密碼 (Store passwords using reversible encryption)**：**請務必停用此選項**。啟用它會讓密碼以可還原的方式儲存，大大降低安全性。

5.  **更新群組原則：**

      * 設定完成後，關閉「群組原則管理編輯器」。
      * 為了讓這些變更立即生效，你可以在網域控制器或受影響的用戶端電腦上開啟命令提示字元 (以管理員身分執行)，然後輸入：
        ```cmd
        gpupdate /force
        ```

-----

### **2. 設定細部密碼原則 (Fine-Grained Password Policies, FGPP)**

FGPP 允許你在同一個網域中為不同的使用者或群組應用不同的密碼策略。這對於需要更高安全性要求的特權帳戶（例如 Domain Admins）非常有用。

**先決條件：**

  * 網域功能等級 (Domain Functional Level) 必須是 Windows Server 2008 或更高版本。
  * 你必須是 `Domain Admins` 群組的成員。

**步驟 (使用 Active Directory 管理中心 - ADAC)：**

1.  **開啟 Active Directory 管理中心 (Active Directory Administrative Center - ADAC)：**

      * 在網域控制器上，點擊「開始」-\>「Windows 系統管理工具」-\>「**Active Directory 管理中心**」。

2.  **導覽至密碼設定容器：**

      * 在 ADAC 左側窗格中，點擊你的**網域名稱 (本機)**。
      * 在中心窗格中，找到並雙擊「**System**」資料夾。
      * 雙擊「**Password Settings Container**」。

3.  **建立新的密碼設定物件 (Password Settings Object, PSO)：**

      * 在右側的「工作」窗格中，點擊「**新增**」，然後選擇「**密碼設定 (Password Settings)**」。

4.  **配置密碼原則：**

      * 在「建立密碼設定」視窗中，配置以下項目：
          * **名稱 (Name)**：為你的 FGPP 命名，例如 `Stricter_Admin_PasswordPolicy`。
          * **優先順序 (Precedence)**：設定一個數字，決定當使用者同時套用多個 FGPP 時，哪個原則會生效（數字越小優先順序越高，例如 1 最高）。
          * **最小密碼長度 (Minimum password length)**
          * **密碼最長使用期限 (Maximum password age)**
          * **強制執行密碼歷程記錄 (Enforce password history)**
          * **密碼必須符合複雜性需求 (Password must meet complexity requirements)**
          * **帳戶鎖定閥值 (Account lockout threshold)**：在多少次失敗登入嘗試後鎖定帳戶。
          * **重設帳戶鎖定計數器的時間間隔 (Reset account lockout counter after)**：多少分鐘後重設鎖定計數器。
          * **帳戶鎖定期間 (Account lockout duration)**：帳戶被鎖定多長時間。
      * **重要：** 這些設定會覆蓋預設網域原則中相同的設定。

5.  **套用至使用者或群組：**

      * 在「建立密碼設定」視窗的底部，找到「**直接套用至 (Directly Applies To)**」。
      * 點擊「**新增**」，然後搜尋並選擇你想要套用此 FGPP 的**特定使用者或群組**。
      * 建議將 FGPP 套用至**安全群組**，而不是個別使用者，這樣管理會更方便。例如，你可以建立一個 `SG_Domain_Admins_FGPP` 群組，並將所有網域管理員帳戶加入其中。

6.  **確認並完成：**

      * 點擊「**確定**」來建立並應用這個 FGPP。

**確認使用者套用的最終密碼原則：**

你可以使用 `Get-ADUserResultantPasswordPolicy -Identity <使用者帳戶名稱>` PowerShell 命令來檢查特定使用者實際套用的是哪個密碼原則。

----- 

## IIS 網頁伺服器
- 角色服務
    - **HTTP重新導向**: 多個網站引導
    - **FTP服務** : IIS底下的檔案傳輸服務

### 測試
在瀏覽器URL輸入`localhost`, `127.0.0.1`, `fileserver.Lab03.com.tw`, `[::1]`
- 有畫面代表IIS安裝成功

### 更改根目錄
1. 工具 > IIS管理
- IIS 管理員
- `FILESERVER`
- 站台
- Default Web Site
- 右側動作 > 基本設定
2. 編輯站台
- 實體路徑 > `D:\wwww` > 確定
3. 在D:\www新增檔案
- 新增`default.htm`
- 或開啟**記事本**後，拖曳default檔案進入軟體編輯
4. 站台網頁
- 站台 > 預設文件
- `default`, `index`, `iisstart` 為默認名稱
- 正向表列，先找到先執行，依序往下找
- 實體目錄、虛擬目錄
5. 實體路徑/虛擬路徑
- 實體路徑可以快速檢測檔案新增刪除修改
- 虛擬路徑可以指定路徑名稱增加可維護性
- IIS管理員 > 起始 > `fileserver` >站台 >Default Web Site > 右鍵 > 新增虛擬目錄 > 虛擬目錄: `home` / 實體目錄: `D:\www\test`





