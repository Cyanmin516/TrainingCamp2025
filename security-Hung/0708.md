# Web security weakness
- speacher: pro. Hung
- date: 2025-7-8


##### 雜談
暴力破解 違法
不建議使用 deepseeker


## 課程涵括
* 網頁攻擊手法介紹
* OWASP Top 10 2021
* 網頁檢測工具介紹與操作
* 網頁弱點分析實戰

## 課程涵括
* 網頁攻擊手法介紹
    * 權限控制失效
    * 加密機制失效
* OWASP Top 10 2021
* 網頁檢測工具介紹與操作
* 網頁弱點分析實戰


### 網頁攻擊

##### HITCON ZERODAY
重置密碼流程風險

####  A01:權限控制失效(BrokenAccessControl): 
使用者可存取未授權的資料
* 備份檔洩漏(.bak.old .swp.tgz.zip)
* 目錄列出
* 免登入即可使用系統
* 權限跨越
    * 垂直：低權限帳號可存取管理者功能
    * 水平：可存取其他同權限使用者功能
``` 
1. client cookie/server session 傳遞驗證，session 用來修改帳戶資訊
2. 強行瀏覽目錄: /admin_getappinfo
```

#### A02:加密機制失效(CryptographicFailures)
* OWASP Top 10 2017稱為「機敏資料外洩」，2021版將此重新進行定義，並將問題核心定義在加密機制的失敗，因而造成機敏資料外洩或系統遭受破壞。
* 通訊傳輸協定是否有使用資料加密機制？
    * 常見未加密通訊資料的協定有HTTP、FTP、TELNET等。
* 使用不安全的加密演算法，
    * 例如：RC4、MD5、SHA1、WEP等。
```
1. md5(md5(md5(123456)))
2. SQL注入攻擊取得解密信用卡資訊
3. 沒有強制使用TLS或支援脆弱的加密，攻擊者將連線降級HTTP，擷取會話(session)cookie
4. 密碼未加鹽，彩虹表還原密文。
```

#### A03:注入式攻擊(Injection)
 * **SQLInjection**
 * **NoSQLInjection**
 * **CommandInjection**
 * **LDAPInjection**
 * **JSONInjection**
 * **CSSInjection**
```
Q:為甚麼網頁要能下cmd
A:使用者可能有轉檔需求
SQL為最常見且最嚴重的攻擊，修改查詢邏輯
CSS 為HTML5常用的工具，但CSS可以做到很多監控
```

#### A04: 不安全設計(InsecureDesign)
* 此為2021版新增的項目，定義與應用程式設計缺陷相關的風險。
    * 例如：機敏資料加密沒有實作方法、OTP非隨機數且不具時效性。 

####  A05: 安全設定缺陷(SecurityMisconfiguration)
* 有90%受測的應用程式存在某種類別的安全設定缺陷，在OWASP Top 10 2017版本中的XML外部實體注入攻擊(XMLExternalEntities) 被合併於這個類別。
* 啟用或安裝不需要的功能、預設帳號未停用或密碼未變更、系統自動更新未啟用、未針對預設設定進行調整或啟用安全功能等，都是導致此問題發生的主要原因
```
1. 營運用的程式伺服器，含有未移除的預設程式，這個程式有已知的安全缺陷，可被攻擊者利用入侵伺服器。
2. 預設的程式帶有管理者介面，並且有未變更的帳號，攻擊者可以透過預設的密碼登入，並取得系統控制權限。 
3. 跳出錯誤訊息:顯示工具的完整版本或路徑
```

####  A06: 危險或過舊的元件(VulnerableandOutdatedComponents)
舊版本的漏洞攻擊

#### A07: 認證及驗證機制失效(IdentificationandAuthenticationFailures)
允許使用弱密碼、未抵擋暴力破解攻擊、未啟用多因子認證機制、暴露Session於網址中、Session管控機制不足等，都是造成此項問題最主要的原因

#### A08: 軟體及資料完整性失效(SoftwareandDataIntegrityFailures)
* 程式碼或基礎架構未能保護軟體及資料之完整性
* 不安全的反序列化
* 使用不受信任來源之套件、函式庫、模組等
* 不安全的持續性整合/部署(CI/CD)流程
* 使用缺乏充足完整性驗證的自動更新
```
Q:驗證使用者上傳檔案完整性
A: 資料庫做雜湊驗證(檔案/MD5雜湊)
資料庫、網頁、檔案、工具...
```

####  A09: 資安記錄及監控失效(SecurityLoggingandMonitoringFailures)
未紀錄可被稽核的事件(例如：登入成功、登入失敗等)、告警或錯誤訊息未產生、未針對可疑的活動進行監測、日誌僅儲存於本地端等，都是導致此問題的主要原因。

####  A10: 伺服端請求偽造(Server-SideRequestForgery)
攻擊者可以利用偽造伺服端請求來攻擊在WAF、防火牆、或網路ACL後面的系統，可能採取之情境如下：
```
情境#1：對內部伺服器Port Scan｜
如果網路架構未被切割，攻擊者能透過結果或連線狀態，判斷內部服務Port 情況。
情境#2：機敏資料洩漏｜
攻擊者可以存取本地端檔案或內部服務取得機敏資料。
情境#3：滲透內部服務｜
攻擊者可以濫用內部服務去執行更進一步的攻擊，例如：RCE或DoS
```

### Kali Linux
kali.org
download > virtual machin > vmware
```
sudo apt update -y
sudo apt upgrade -y
sudo apt install docker-compose docker.io -y
sudo systemctl start docker
sudo systemctl enable docker
sudo docker run -d -it -p 8080:80 vulnerables/web-dvwa
sudo docker run -d -p 8081:3000 bkimminich/juice-shop
```

boot the docker
```
#show ur containers and status
sudo docker ps -a
sudo docker start `your_docker_name_long_name_match_character`

```

#### 套件管理器
>套件 install 套件名稱
* RedHat: yum(old), dnf(new)
* debean、ubuntu、kali: apt-get(old), apt(new)

#### 注入攻擊
讓輸入執行多個指令
特殊符號`&;|`連接指令
```
127.0.0.1 & cat /etc/passwd
127.0.0.1 ; cat /etc/passwd
127.0.0.1 | cat /etc/passwd
```
#### DVWA 網頁教學
admin/password


#### burpsuite
community version can not save config and file
介面無法輕易修改，藉由proxy修改封包
在使用者與伺服器之間過濾封包

1. low passby all words
> 1' or '1
2. medium passby limit words but not rule
> 1 or 1

