# 路由OSPF 
- speacher: pro. Chen
- date: 2025-10-03
- class 17
- CCNA3 chapter2 OSPF
- CCNA3 chapter3 security 
- CCNA3 chapter4 解釋 ACL
- CCNA3 chapter5 設定 ACL
#OSPF #securtiy #ACL必考 

## 實務
指定OSPF成本時兩端應設定一致(基本上)
多重存取網路才有DR,BDR

完全指定路由，指定介面或指定IP要二次查找路由表
路由器IP/30
路由器末端還是要加入OSPF才能設定被動介面
介面設定OSPF比較直覺且不容易因為遮罩計算出錯

雲端系統的資料應該自己加密再上傳存放
虛擬機來測試開源軟體

弱點掃描 : Open VAS
實務上很常修改ACL

## 練習2.7.1綜合OSPF
```sh
show ip 
觀察網路
設定加入OSPF網段及區域ID
設定路由ID決定OSPF DR BDR
ip route ospf 10

停用介面，網路末端不用路由
R(cfg)# router ospf 10
R(cfg-router)# passive-interface g0/0/0

設定權重，最大優先
R(cfg-if)# ip ospf priority [0-255]

設定度量值
R(cfg-if)# ip ospf cost 50

設定靜態預設路由
R(cfg)# ip route 0.0.0.0 0.0.0.0 s0/0/0
透過OSPF傳達閘道路由
R(config-router)# default-information originate 

設定頻寬，而且要設定所有路由器
R(cfg-router)# auto-cost reference-bandwidth 1000 (Mbps)

設定溝通間隔
R(cfg-if)# ip ospf hello-interval 20
R(cfg-if)# ip ospf dead-interval 80


檢查
觀察網路
show ip route 
觀察需要設定被動OSPF
do show ip route connected

指定OSPF DR最優先等級
BC-1(config)#interface g0/0/0
BC-1(config-if)#ip ospf priority 255
```

優先度要設定在介面上
介面上啟動OSPF跟直接指定OSPF網域的差異


## 資安現況

安全性條款
- 資產 : 人、設備、資源和資料
- 弱點 : 弱點
- 威脅 : 潛在危險
- 利用 : 漏洞機制
- 緩解 : 降低威脅或危險的對策，多重緩解技術。
- 風險 : 負面影響程度

改善風險需要錢，降低風險到警戒程度以下。

### 攻擊
偵測攻擊
存取攻擊

### 3.9機密性、完整性、可用性
- 機密 : 加密敏感資訊
- 完整 : 未受竄改
- 可用 : 持續服務，備援服務、閘道、鏈路

#### 防火牆
#### IPS
入侵防禦系統

- ESA : Cisco Email Security Appliance
- WSA : Cisco web security Appliance

- goolge瀏覽器有內建黑名單，需要使用者手動連線



## ACL
Acess contorl list : 用來過濾流量
預設路由器沒有ACL，啟動時會檢查所有網路封包決定是否轉送。

- 限制網路流量
- 流量控制
- 存取安全
- 過濾流量類型
- 過濾主機存取
- 優先度

第三四層

思科路由器
標準ACL : 僅L3過濾IPv4
延伸ACL : 檢查L4服務

3P原則
per protocol  : 協定 
per interface : 介面
per desnation : 進出

### 運作
1. 提取IPV4
2. 來源IP比較ACE
3. 相符ACE立刻接受或拒絕，不再往後判斷
4. 來源不符合所有，丟棄

ACL至少一個允許陳述是

### 練習4.1.4
```sh
移除介面ACL
interface S0/0/0
no ip access-group 11 out
exit
no access-group 11

觀察設定
show running-config
```
### ACL 
數量
ACL 1-99、1300-1999 : 只能過濾IPv4來源
ACLe 100-199 : 
R(cfg)# access-lit <1-199> <deny/permit/remark> <host/any> 

每個介面最多四個ACL
IPv4 IN
IPv4 OUT
IPv6 IN
IPv6 OUT

### 實作方法
安全政策ACL
ALC動作
文字編輯所有ACL
使用remark命令製作說明
先在開發上測試ACL，在運轉實體網路

ACL 標籤格式
- 只能是英文數字
- 建議用大寫


### 設置ACL
標準ALC盡量放靠近目的端
延伸ALC盡量放靠近來源端

## ACL 語法
```sh
設定 ACL 規則
Router(config)# access-list access-list-number {deny | permit | remark text} source [source-wildcard] [log]
接受或拒絕，remark用來記錄訊息方便維護沒有功能

設定介面
Router(config-if) # ip access-group {access-list-number | access-list-name} {in | out}

do show access-list
show ip interface s0/0/0 | include access list

介面設定ACL規則
interface g0/0
ip access-group 20 in                                                        


ip access standard LAN2-FILTER
R(cdf-std-nacl)# ip access-group LAN2-FILTER out         

show running-config
show access-lists

```
### practice 5.1.7

```sh
建立ACL20規則
R1(config)#access-list 20 deny host 192.168.10.10
R1(config)#access-list 20 permit 192.168.10.0 0.0.0.255
介面設定
R1(config)#interface g0/0/0
R1(config-if)#ip access-group 20 in

新增標籤ACL
R1(config)#ip access-list standard LAN2-FILTER
R1(config-std-nacl)#permit host 192.168.10.10
R1(config-std-nacl)#deny any
R1(config-if)#ip access-group LAN2-FILTER out
```

### practice 5.1.9
```sh
R1(config)# ip access-list standard File_Server_Restrictions
R1(config-std-nacl)# permit host 192.168.20.4
R1(config-std-nacl)# permit host 192.168.100.100
R1(config-std-nacl)# deny any

R1(config)# interface fa0/1
R1(config-if)# ip access-group File_Server_Restrictions out
使用 show access-list 命令驗證 ACL 設定。使用 show run 或 show ip interface fastethernet 0/1 命令來驗證 ACL 是否正確地套用到介面。

```

### 5.2 修改ACL
show access-lists
序列10,20方便插入細目
小範圍優先，主機條件最優先

```sh
R1# show ip access-lists
R1(config)# ip access-list standard 1
R1(config-std-nacl)# no 10
插入修改規則
R1(config-std-nacl)#10 deny host 192.168.10.10
```


### 5.3.4保護連接埠
```sh
設定帳戶
R1(config)#username ADMIN secret class
設定原則
R1(config)#ip access-list standard ADMIN-HOST
R1(config-std-nacl)#permit host 192.168.10.10
R1(config-std-nacl)#deny any
R1(config-std-nacl)#exit
設定遠端
R1(config)#line vty 0 4
R1(config-line)#login local
R1(config-line)#transport input telnet
設定遠端存取源則
R1(config-line)#access-class ADMIN-HOST in
檢查
R1#show access-lists
```





















## Gemini
這是個關於**路由器設定**和**OSPF（開放式最短路徑優先）協定**的很好的問題。

您的問題其實包含了兩個不同的設定概念，我們分開來看：

---

## 1. 優先度（Priority）設定在介面上

您提到的「**優先度要設定在介面上**」，這在**OSPF**協定中，指的是設定該介面的**Router Priority**（路由器優先度）值。

* **用途：** 這個值主要用於在**多重存取（Multi-access）網路**（例如：乙太網路）中，協助選舉**指定路由器（Designated Router, DR）**和**備用指定路由器（Backup Designated Router, BDR）**。
* **設定位置：** 必須在**路由器介面**的設定模式下進行。
* **如何運作：**
    * 在一個網段中，OSPF路由器會比較彼此的**Router Priority**值。
    * **Router Priority**值**最高**的路由器會成為 **DR**。
    * **次高**的會成為 **BDR**。
    * 預設值通常是 $1$。
    * 如果將優先度設為 **$0$**，則該路由器**永遠不會**參與 **DR/BDR** 的選舉。
    * 如果優先度相同，則會比較 **Router ID**，**Router ID 較高**的勝出。

---

## 2. 介面上啟動OSPF vs. 直接指定OSPF網域

這兩個動作雖然都會讓該介面參與 **OSPF**，但它們在設定的方式和細節上有所不同，這通常取決於您使用的**路由器廠商**和**作業系統**（例如 Cisco IOS、Juniper Junos 等）。

### 差異比較

| 特性 | **介面上啟動 OSPF** | **直接指定 OSPF 網域** |
| :--- | :--- | :--- |
| **設定方式** | 在**介面**設定模式下，使用如 `ip ospf <process-id> area <area-id>` 的指令。 | 在**路由程序**（`router ospf <process-id>`）模式下，使用 `network <network-address> <mask> area <area-id>` 的指令。 |
| **精確度** | **高精確度**：直接作用於單一介面，設定清晰。 | **範圍較廣**：使用網路位址和遮罩來**匹配**多個介面。 |
| **主要功能** | **直接**啟用該介面上的 OSPF 協定，並定義它屬於哪個 **Area**（網域）。 | 告訴 OSPF 程序**哪些網路位址**上的介面應該被包含在 OSPF 路由協定中，並指定它們的 **Area**。 |
| **優點** | **簡潔且精確**，特別適用於只希望在特定介面上啟用 OSPF 的情況。 | 適合一次性匹配**多個**相鄰的子網路或介面。 |

### 簡化理解（以 Cisco 為例）

| 情境 | 介面上啟動 OSPF | 直接指定 OSPF 網域 |
| :--- | :--- | :--- |
| **設定動作** | 進入 `GigabitEthernet0/1` 介面，輸入 `ip ospf 1 area 0` | 進入 `router ospf 1` 程序，輸入 `network 192.168.1.0 0.0.0.255 area 0` |
| **結果** | **僅** `GigabitEthernet0/1` 介面參與 OSPF Area 0。 | **所有** IP 位址落在 $192.168.1.x$ 範圍內的**啟用介面**都將參與 OSPF Area 0。 |

### 結論：

在現代或更精確的網路設計中，許多工程師傾向於在**介面模式下**直接啟用 OSPF，因為它提供了**更明確**和**更直觀**的配置，避免了使用通配符遮罩（wildcard mask）可能帶來的錯誤或意外匹配到不需要的介面。

不過，兩者最終的目標都是讓特定的介面開始與鄰居交換 **OSPF 封包**，並宣告其連接的網路。 

## Gemini 2
這是個關於**路由器設定**和**OSPF（開放式最短路徑優先）協定**的很好的問題。

您的問題其實包含了兩個不同的設定概念，我們分開來看：

---

## 1. 優先度（Priority）設定在介面上

您提到的「**優先度要設定在介面上**」，這在**OSPF**協定中，指的是設定該介面的**Router Priority**（路由器優先度）值。

* **用途：** 這個值主要用於在**多重存取（Multi-access）網路**（例如：乙太網路）中，協助選舉**指定路由器（Designated Router, DR）**和**備用指定路由器（Backup Designated Router, BDR）**。
* **設定位置：** 必須在**路由器介面**的設定模式下進行。
* **如何運作：**
    * 在一個網段中，OSPF路由器會比較彼此的**Router Priority**值。
    * **Router Priority**值**最高**的路由器會成為 **DR**。
    * **次高**的會成為 **BDR**。
    * 預設值通常是 $1$。
    * 如果將優先度設為 **$0$**，則該路由器**永遠不會**參與 **DR/BDR** 的選舉。
    * 如果優先度相同，則會比較 **Router ID**，**Router ID 較高**的勝出。

---

## 2. 介面上啟動OSPF vs. 直接指定OSPF網域

這兩個動作雖然都會讓該介面參與 **OSPF**，但它們在設定的方式和細節上有所不同，這通常取決於您使用的**路由器廠商**和**作業系統**（例如 Cisco IOS、Juniper Junos 等）。

### 差異比較

| 特性 | **介面上啟動 OSPF** | **直接指定 OSPF 網域** |
| :--- | :--- | :--- |
| **設定方式** | 在**介面**設定模式下，使用如 `ip ospf <process-id> area <area-id>` 的指令。 | 在**路由程序**（`router ospf <process-id>`）模式下，使用 `network <network-address> <mask> area <area-id>` 的指令。 |
| **精確度** | **高精確度**：直接作用於單一介面，設定清晰。 | **範圍較廣**：使用網路位址和遮罩來**匹配**多個介面。 |
| **主要功能** | **直接**啟用該介面上的 OSPF 協定，並定義它屬於哪個 **Area**（網域）。 | 告訴 OSPF 程序**哪些網路位址**上的介面應該被包含在 OSPF 路由協定中，並指定它們的 **Area**。 |
| **優點** | **簡潔且精確**，特別適用於只希望在特定介面上啟用 OSPF 的情況。 | 適合一次性匹配**多個**相鄰的子網路或介面。 |

### 簡化理解（以 Cisco 為例）

| 情境 | 介面上啟動 OSPF | 直接指定 OSPF 網域 |
| :--- | :--- | :--- |
| **設定動作** | 進入 `GigabitEthernet0/1` 介面，輸入 `ip ospf 1 area 0` | 進入 `router ospf 1` 程序，輸入 `network 192.168.1.0 0.0.0.255 area 0` |
| **結果** | **僅** `GigabitEthernet0/1` 介面參與 OSPF Area 0。 | **所有** IP 位址落在 $192.168.1.x$ 範圍內的**啟用介面**都將參與 OSPF Area 0。 |

### 結論：

在現代或更精確的網路設計中，許多工程師傾向於在**介面模式下**直接啟用 OSPF，因為它提供了**更明確**和**更直觀**的配置，避免了使用通配符遮罩（wildcard mask）可能帶來的錯誤或意外匹配到不需要的介面。

不過，兩者最終的目標都是讓特定的介面開始與鄰居交換 **OSPF 封包**，並宣告其連接的網路。
 


 ## Gemini 3 


**萬用遮罩 ($\text{Wildcard Mask}$)** 是路由器在執行某些功能時，用來**定義 $\text{IP}$ 位址範圍**的一種特殊工具。

它與我們常用的**子網路遮罩 ($\text{Subnet Mask}$)** 恰好相反，功能也不是用來劃分網路，而是用於**匹配**。

萬用遮罩的主要應用場景有兩大類：**安全過濾**和**路由協定配置**。

---

## 萬用遮罩的運作原理

萬用遮罩是一個 $32$ 位元的數值，通常以點分十進位表示（例如 $0.0.0.255$）。它定義了 $\text{IP}$ 位址中的哪些位元**必須**匹配，哪些位元可以**被忽略**。

| 二進位位元 | 數值意義 |
| :--- | :--- |
| **0** ($\text{Match}$) | 該 $\text{IP}$ 位元必須**精確匹配**（檢查）。 |
| **1** ($\text{Ignore}$) | 該 $\text{IP}$ 位元可以**任意值**（不檢查）。 |

例如，要匹配整個 $192.168.1.0/24$ 網段，它的子網路遮罩是 $255.255.255.0$。計算萬用遮罩的方式就是用 $255.255.255.255$ 減去子網路遮罩：
$$255.255.255.255 - 255.255.255.0 = \mathbf{0.0.0.255}$$

這個 $\mathbf{0.0.0.255}$ 萬用遮罩代表：前三個位元組**必須**匹配（$0$），最後一個位元組**可為任意值**（$255$），因此匹配了該網段的所有 $\text{IP}$。

---

## 路由器使用萬用遮罩的兩大主要功能

### 1. 存取控制列表 ($\text{ACL}$ - Access Control List) 🛡️

這是萬用遮罩最常見且重要的用途。 $\text{ACL}$ 是路由器用來**過濾流量**、實現網路安全和流量控制的規則集。

* **功能：**
    * **定義流量來源或目的地的 $\text{IP}$ 範圍：** 使用萬用遮罩，$\text{ACL}$ 可以精確地允許 ($\text{Permit}$) 或拒絕 ($\text{Deny}$) **單一主機**、**整個子網路**、或**一組不連續的 $\text{IP}$ 地址**進出路由器介面。
    * **精確匹配單一主機：** 萬用遮罩 $0.0.0.0$ 表示 $\text{IP}$ 位址的 $32$ 個位元全部必須精確匹配。
        * *範例：* `permit ip host 10.1.1.1` (等同於 `permit ip 10.1.1.1 0.0.0.0`)
    * **精確匹配整個網段：** 萬用遮罩 $0.0.0.255$ 表示只檢查前 $3$ 個位元組。
        * *範例：* `deny tcp 192.168.5.0 0.0.0.255 any eq 23` (拒絕整個 $192.168.5.0/24$ 網段的 $\text{Telnet}$ 流量)

* **優勢：** 提供了極高的**彈性**，可以設計出比單純匹配子網路更複雜和更細緻的過濾邏輯。

---

### 2. 路由協定配置 ($\text{OSPF/EIGRP}$ 等) 🗺️

在配置某些內部閘道協定 ($\text{IGP}$) 時，萬用遮罩用於定義**哪些介面**應該運行該路由協定，以及**哪些網路**應該被宣告。

#### A. OSPF (Open Shortest Path First)

* **功能：** 用於 $\text{OSPF}$ 的 $\text{network}$ 指令中，以**匹配**路由器上介面的 $\text{IP}$ 位址。一旦匹配成功，該介面就會：
    1.  開始運行 $\text{OSPF}$ 協定（發送 $\text{Hello}$ 封包）。
    2.  將該介面連接的網路**宣告**到指定的 $\text{OSPF Area}$（區域）中。
* **範例：** `network 172.16.0.0 0.0.255.255 area 0`
    * 這條指令告訴路由器：檢查所有 $\text{IP}$ 位址以 $172.16$ 開頭的介面（忽略後兩個位元組），並在這些介面上啟動 $\text{OSPF}$，將其歸類到 $\text{Area 0}$。

#### B. 路由過濾和分發控制

* **功能：** $\text{Wildcard Mask}$ 也用於 **Route-Map** 和 **Prefix-List** 中，精確地定義要被**重新分發** ($\text{Redistribution}$)、**允許**或**拒絕**的路由字首 ($\text{Prefix}$)。

---

## 萬用遮罩的優勢總結

萬用遮罩之所以在路由器配置中不可或缺，是因為它提供了：

1.  **靈活性 (Flexibility)：** 它可以匹配**不連續**的 $\text{IP}$ 範圍（儘管這在 $\text{OSPF}$ 中通常不被建議，但在 $\text{ACL}$ 中可以實現複雜的匹配）。
2.  **效率 (Efficiency)：** 只需一個 $\text{ACL}$ 條目就可以處理整個網段或多個網段，減少了 $\text{ACL}$ 的總長度，提高路由器處理效率。
3.  **精確控制 (Precision)：** 能夠精準控制哪些路由器的**介面**參與路由協定，以及哪些 $\text{IP}$ **流量**被允許通過。

簡而言之，**萬用遮罩**就是路由器用來**「告訴」**自己：**「關於這個 $\text{IP}$ 位址，我只需要檢查哪幾個位元就好」**的關鍵語法。
