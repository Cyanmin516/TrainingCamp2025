# Switch Security Configuration and wireless area
- speacher: pro. Chen
- date: 2025-8-29
- class 14
- CCNA2 chapter 11 vlan attack protect
- CNNA2 chapter 12 wireless local area
- CNNA2 chapter 13 wireless setting

#switchport_port-security #sw_po_mac_sticky #sw_po_violation_restrict #port綁定 #違規處置 #VLAN-attack #ip_dhcp_snooping #ip_arp_inspection #AP #2.4GHz #無線網路部屬 #無線路由器設定

## 實務做法
DHCP通常會架設兩台，用戶會使用回應最快的那個IP

## switchport port-security
管理個別switchport 啟動port-security 規則，掌控能學習的機器最大數量。並對違規事件紀錄並處置。
- shutdown, 違規後關閉介面
- restrict, 違規管制並記錄
- protect, 違規管制不紀錄

使用sticky 學習硬體MAC，
**cmd of port-security**
```console
S1(config)# interface range f0/1 - 2
S1(config-if-range)# switchport port-security
S1(config-if-range)# switchport port-security maximum 1
S1(config-if-range)# switchport port-security mac-address sticky
S1(config-if-range)# switchport port-security violation restrict
S1(config-if-range)# interface range f0/3 - 24 , g0/1 - 2
S1(config-if-range)# shutdown
```

**check**
1. show port-security
查看每個啟動port-security 的介面統計資料

2. show port-security interface 0/2
查看該port詳細資料
```
服務啟動
port security : enable
違規處理方式
violation mode : restrict
該port學習限制，防止外部設備偷接
max mac addresses: 1
```

3. who port-security address
查看Security Mac address內容


##### sample 11.1.10
learning port-security


## 實務

- vlan整個系統 在100個以內
- 大部分switch 只會有10個Vlan做管理
- switch 並不會設定所有vlan
- 重要設施才會設置native vlan


## 11.2.1 VLAN 攻擊

1. DTP攻擊
2. 雙重vlan

### 緩解vlan威脅
1. 設定 switchport mode acccess 而非DTP自動中繼
2. 停用未使用介面
3. 使用 switchport nogegotiate 的自動協商通訊
4. 使用指令 switchport trunk native vlan `vlan_Number` 設定 vlan 1 以外的vlan


### practice 11.2.3
- set sw mode access and vlan change then shutdown
- trunk native vlan
- no DTP 

## 11.3 DHCP attack
DHCP 飢餓攻擊, 拿光IP
DHCP採信任連接，並設置DHCP偵聽(layer4)，阻擋非法DHCP

交換器DHCP偵聽
1. ip chcp snooping
2. 信任通訊埠上，使用ip dhcp snooping trust
3. 介面設定 ip dhcp snooping limit rate 3
4. 那些vlan會啟用 ip dhcp snooping vlan 5,10,50-52

DHCP trust 對上DHCP設備port
如果DHCP跨網段，switch 對路由器的port也應設定為trush

### practice
dhcp snooping
```console
S1(config)#ip dhcp snooping
S1(config)#interface range g0/1 - 2
S1(config-if-range)#ip dhcp snooping trust
S1(config)#interface range f0/1 - 24
S1(config-if-range)#ip dhcp snooping limit rate 10
S1(config)#ip dhcp snooping vlan 10,20,30-49
```

檢查
```
查看詳細介面
show ip dhcp snooping
IP 對照 MAC
show ip dhcp snooping binding
```


## 11.4 動態 arp檢查
1. 無效攔查
2. 攔截不信任
3. 認證IP-MAC
4. 紀錄違規
5. 阻斷威脅

### DAI
DAI= dynamic ARP inspection requires DHCP snooping and help prevent ARP attacks
1. 全域啟動DHCP偵聽
2. 特定vlan上啟動DHCP
3. 選取VLAN啟用DAI
4. 設定可信任介面 DHCP真聽語 ARP檢查

- 其他設備都設定為不信任
- 上行連接路由器與DHCP設定為信任
### 11. sample ARP inspection
啟用DAI服務需要同時啟動dhcp snooping
檢查目的MAC, 來源MAC, 與IP地址

```
先啟用監聽DHCP然後監聽ARP
S1(config)# ip dhcp snooping
選定vlan
S1(config)# ip dhcp snooping vlan 10
S1(config)# ip arp inspection vlan 10
S1(config)# interface fa0/24
S1(config-if)# ip dhcp snooping trust
S1(config-if)# ip arp inspection trust

監控ARP 來源目的與位址需同時設定
S1(config)# ip arp inspection validate src-mac dst-mac ip
S1(config)# do show run | include validate
```

## 11.5 PortFast and BPDU Guard 
- PortFast : 正常學習要50秒，從封鎖轉轉送。應只設定在終端裝置
- BPDU Guard : 立刻禁用錯誤介面收到BPDU。應只設定在終端裝置
- 同時設定且介面必須是access mode

```
介面設定
S1(config)#interface range fa0/1 - 24
S1(config-if-range)#switchport mode access
S1(config-if-range)#exit
S1(config)#exit 

開啟規則
S1(config)#spanning-tree portfast default
開啟監控
S1(config)#spanning-tree portfast bpduguard default
S1(config)# exit

檢查
show spanning-tree summary
```

bpdu 偵測自動停用:
- 管理者: 進入介面shutdown then no shutdown


## 無線網路
不用線路傳輸

### 實務
DLP裝置: data leak protection
- 關鍵字管理過濾
- 禁止含有關鍵字的檔案
內部網路防火牆隔絕病毒汙染

### 類型
1. WPAN wireless personal-area network : 2.4 GHz , like bluetooth
2. WLAN Wireless LANs: 標準802.11 使用2.4GHz and 5GHz
3. WMAN wireless MANs : 大型基地台
4. WWANs wireless wide-area networks : 衛星通訊

### 標準
IEEE 802.11制定標準
WIFI聯盟 驗證無線通訊設備審核

### 天線
1. 全向性天線 : 天線棍棒指向兩側訊號最弱
2. 指向性天線 : 八木天線、碟型天線
3. MIMO天線 : 多天線

### 連線模式
1. 隨意(ad hoc)模式: P2P連接
2. 基礎架構(infrastructure)模式 : 無線AP或交換機接通裝置，有線連線網際網路
3. 共用網路tethering模式 : 手機熱點，基地台+藍芽

### 網路覆蓋
1. BSS : 分別連上設備網路
2. ESS : 使用相同SSID提供服務


### 802.11訊框

### 12.3.5 CSMA/CA 無線網路
CSMA/CD 有線網路協議
碰撞偵測，如果有就繼續等待

### 12.3.7 AP
1. 被動模式，定期發送SSID給附近裝置
2. 主動模式探索，用戶主動要求SSID與支援標準

### 12.4.2 CAPWAP
- 無線控制器 統一管理AP與無線區域網路
- IEEE標轉
- UDP傳遞，DTLS加密

| AP MAC功能 | WLC MAC功能 |
|:-|:-|
| 信標和探測 | 驗證 |
| 封包確認和重新輸入 | 漫遊用戶端的關聯和重新關聯 |
| 封包等待與權重 | 轉換協定 |
| 第二層加密 | 在線路上使用802.11協議 |


CAPWAP通道用802.11走實體線路
控制: 傳輸時 啟用DTLS 
資料: 傳輸時 沒有使用DTLS

彈性AP當WLC無法存取時執行本機認證

### 12.5 頻率通道飽和
- 變頻通訊
- 跳頻通訊
- 正交多重頻道


**2.4GHz有11個頻道**
每5MHZ 切出一個頻道 2.2GHZ-2.4GHZ
1, 6, 11頻道完全分離 達到三通到傳輸

#### 干擾源
任何有無線電波的設備都會產生干擾
舉例:  微波爐、無線監視器、螢光燈、動作偵測器



**規劃無線網路部屬**
- AP放置障礙物上方
- AP放在預期使用者所在的位置，教室比走廊好

DIY天線
- 撈麵杓(雷達形狀)
- 天線放大器

### 12.7.4 共用金鑰驗證
1. WEP: 靜態金鑰，已經破解
2. WPA: 更改每個封包密鑰
3. WPA2: AES加密
4. WPA3: 還在普及

個人:預先共享金鑰，WPA2 personal
企業:WPA2 Enterprise ，要指向認證伺服器


WPA3
- personal
- Enterprise
- OPEN，不認證但加密傳輸
- IoT，三方認證


## 13 無線路由器
通常包含WLAN, DHCP, NAT, QoS


無線路由器設定
```
登入無線路由器
使用LAN PORT登入(192.168.0.1)
預設帳號密碼 admin/admin ，有風險一定要改
2.4GHz 如果舊設備加入會拖慢
5GHz 建議只使用新協議
設定SSID名稱
更改頻道，使用手機軟體掃描2.4頻道(1,6,11)三個互不干擾

QoS 預設 中，調整優先轉發順序
連接埠轉發，設定port自動轉發內部IP
```

### 